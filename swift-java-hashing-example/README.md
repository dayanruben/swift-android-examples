# swift-java on Android

This example contains a sample Android application that demonstrates how to call Swift code from a Android app. 
The example consists of an Android application (`hashing-app`) and a Swift library (`hashing-lib`) that performs a SHA256 hash on a given string.
The Swift library uses [swift-java](https://github.com/swiftlang/swift-java) and the new JNI mode to automatically
generate Java wrappers for calling into the Swift library.

![IDE Screenshot](resources/ide.png)

## Overview

The project is structured into two main parts:

1.  **`hashing-lib`**: A Swift package that uses `swift-crypto` to provide a hashing function. It is configured with a Gradle build script (`build.gradle`) that compiles the Swift code into an Android Archive (`.aar`) file. This module utilizes the [swift-java](https://github.com/swiftlang/swift-java) project to create the necessary JNI bindings.

2.  **`hashing-app`**: A standard Android application written in Kotlin using Jetpack Compose. It includes the `.aar` file generated by `hashing-lib` as a local dependency and calls the Swift `hash` function when the user presses a button.

## Prerequisites

Before you can build and run this project, you need to have the following installed:

* **Java Development Kit (JDK)**: This example requires the use of JDK 25. This is only necessary to locally publish the swift-java dependencies, and will not be required in the future. To simplify the build steps, we recommend installing JDK 25 and following all the steps below using the same JDK. Ensure the `JAVA_HOME` environment variable is set to your JDK installation path.
* **Swiftly**: You need to install [Swiftly](https://www.swift.org/install/)
* **Swift SDK for Android**: You need to install the [Swift SDK for Android](https://swift.org/install)

## Setup and Configuration

### Prepare Swift Android SDK and matching Swift

Currently these examples utilize very recent nightly Swift Android SDK versions. In order to install these, you can use Swiftly (the Swift toolchain installer):

You can follow [these instructions](https://www.swift.org/documentation/articles/swift-sdk-for-android-getting-started.html) to install an appropriate Swift SDK for Android.

### Publish `swift-java` packages locally
As the `swift-java` project does not yet publish the necessary Java packages needed at runtime, we need to do it ourselves, by performing the following steps:

> Note: This step will not be necessary once swift-java publishes releases.

In order to publish all artifacts from this library, you must use JDK 25, because some parts of swift-java are built for the most recent Java versions. You will not have to use JDK 25 for the rest of the development process.
A simple way to install and manage local Java installations is [sdkman](https://sdkman.io):

> Note: You will _not_ have to use most recent Java versions for your Android app, and the example currently targets Java language version 11.

```bash
curl -s "https://get.sdkman.io" | bash
sdk install java 25.0.1-amzn --use # only in order to publish swift-java artifacts locally

export JAVA_HOME="${HOME}//.sdkman/candidates/java/current"
```

Next, let's prepare and publish the swift-java support libraries:

1.  Enter the `hashing-lib` directory
    ```bash
    cd hashing-lib
    ```
2.  Resolve Swift Packages
    ```bash
    swift package resolve
    ```
3. Publish the `swift-java` packages to local Maven repo
    ```bash
    ./.build/checkouts/swift-java/gradlew --project-dir .build/checkouts/swift-java :SwiftKitCore:publishToMavenLocal
    ```

## Running the example

1.  Open the `swift-android-examples` project in Android Studio.

2.  Select the `hashing-app` Gradle target.

3.  Run the app on an Android emulator or a physical device.

4.  Enter any text into the text field and press the "Hash" button. The app will call the Swift `hash` function, and the resulting SHA256 digest will be displayed on the screen.

### Only building the Swift Library (`hashing-lib`)

1.  Run the Gradle assemble command from the root directory. This will compile the Swift code for all supported Android ABIs (arm64-v8a, armeabi-v7a, x86_64), run the `jextract` plugin, and package everything into an `.aar` file.
    ```bash
    ./gradlew :hashing-lib:assembleRelease
    ```

3.  After a successful build, the Android library will be located at `swift-java-hashing-example/hashing-lib/build/outputs/aar/hashing-lib-release.aar`.
